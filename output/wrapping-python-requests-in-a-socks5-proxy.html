<!DOCTYPE html>
<html lang="en">
  <head>
    <link href='http://fonts.googleapis.com/css?family=Noticia+Text:400,700' rel='stylesheet' type='text/css' />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="description" content="">
    <meta name="author" content="Sean Beck">

    <title> Wrapping Python requests in a SOCKS5 proxy | Show Me the Code </title>

    <link rel="stylesheet" href="/theme/css/style.css" type="text/css" />
    <link rel="stylesheet" href="/theme/css/pygments.css" type="text/css" />
    <link rel="stylesheet" href="/theme/css/font-awesome.css" type="text/css"/>
    <link rel="shortcut icon" href="/theme/images/favicon.ico">
  </head>
  <body>
    <div class=container>
<div class="header">
    <a href="/index.html">Show Me the Code</a> <span class="muted"></span>
</div>

<div class=navigation>
    <ul>
            <li><a href="/index.html">Blog</a> </li>
            <li><a href="/archives.html">Archive</a> </li>
            <li><a href="/tags.html">Tags</a> </li>
            <li><a href="/about.html">About</a> </li>
    </ul>
</div>
<div class=separator></div>        
        <div class=body>
    <h1 class="title"> Wrapping Python requests in a SOCKS5 proxy</h1>
    <p class=date> Feb 09, 2015 </p>
    <p>I have run into situations when I wanted to route some of my Python requests out to the internet through a SOCKS5 proxy, specifically through <a href="https://www.torproject.org/">Tor</a>. There are answers out there on Stack Overflow but they are not all extremely clear.</p>
<p>The easiest way to wrap all requests done by a Python module in a SOCKS proxy is to use the SocksiPy library. The project was abandoned by its owner around 2007. Someone made a few modifications after that, but also abandoned it eventually in 2010. Thankfully the code still works! The latest version can be downloaded from <a href="https://code.google.com/p/socksipy-branch/">here</a>.</p>
<p>To install, simply move the <code>socks.py</code> file into your Python installation's library directory (<code>/usr/local/lib/python2.7/dist-packages</code> for me on Crunchbang).</p>
<p>Using it is also simple. Just import the module, set the proxy information, then wrap the module you want to have proxied. </p>
<div class="highlight"><pre><span class="kn">import</span> <span class="nn">smtplib</span>

<span class="kn">import</span> <span class="nn">socks</span>

<span class="n">socks</span><span class="o">.</span><span class="n">setdefaultproxy</span><span class="p">(</span><span class="n">socks</span><span class="o">.</span><span class="n">PROXY_TYPE_SOCKS5</span><span class="p">,</span> <span class="s">&#39;127.0.0.1&#39;</span><span class="p">,</span> <span class="mi">9050</span><span class="p">)</span>
<span class="n">socks</span><span class="o">.</span><span class="n">wrapmodule</span><span class="p">(</span><span class="n">smtplib</span><span class="p">)</span>
</pre></div>


<p>After this all things done by smtplib will be sent through your proxy. The above code is designed to work with a running local <code>tor</code> installation. </p>
<p>This is a great and simple solution to all your proxy needs (SOCKS4, SOCKS5, or HTTP).</p>
    
<div class=twitter>
<a href="https://twitter.com/share" class="twitter-share-button">Tweet</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
</div>
    <p class=tags>This entry was tagged as
      <a href="/tag/python.html">python</a>
      <a href="/tag/how-to.html">how-to</a>
    </p>
        </div>
        
<div class=footer>
  <p>&copy; Copyright <script language="JavaScript">var date = new Date(); document.write(date.getFullYear());</script> by Sean Beck</p>
  <p> Powered by <a href="http://pypi.python.org/pypi/pelican/" target="_blank">Pelican</a>.  
    <a href="https://github.com/fjavieralba/flasky">Theme</a>  by <a href="http://fjavieralba.com">fjavieralba</a>
  </p> 
  <p>
    <div class=social style="font-size: 27px;">
      <ul>
<script language="JavaScript">
          u = 'seanmckaybeck';
          s = 'gmail.com';
          document.write('<a href=\"mailto:' + u + '@' + s + '\" target=\"_blank\">');
        </script>
            <li><i class="icon-envelope icon-large"></i> </li>
        </a><a href="http://twitter.com/seanmckaybeck" target="_blank"> <li> <i class="icon-twitter-sign icon-large"> </li></i> </a><a href="https://www.linkedin.com/in/seanmckaybeck" target="_blank"><li><i class="icon-linkedin-sign icon-large" ></i></li></a><a href="https://github.com/ThaWeatherman" target="_blank"> <li> <i class="icon-github-sign icon-large"></i> </li> </a>

        <a href="https://seanmckaybeck.com/feeds/all.rss.xml" rel="alternate" title="Recent Blog Posts"><li> <i class="icon-rss icon-large"></i> </li></a>
      </ul>
    </div>
  </p>
</div>    </div>
  </body>
</html>
